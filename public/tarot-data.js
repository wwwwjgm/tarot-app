// public/tarot-data.js

// 完整 78 張塔羅牌資料
const TAROT_DECK = [
  // ===== Major Arcana 大阿爾克那 0–21 =====
  {
    id: "major-0",
    name: "The Fool",
    cnName: "愚人",
    arcana: "major",
    number: 0,
    keywords: ["開始", "自由", "冒險", "信念一跳"],
  },
  {
    id: "major-1",
    name: "The Magician",
    cnName: "魔術師",
    arcana: "major",
    number: 1,
    keywords: ["行動", "資源運用", "顯化", "掌控局面"],
  },
  {
    id: "major-2",
    name: "The High Priestess",
    cnName: "女祭司",
    arcana: "major",
    number: 2,
    keywords: ["直覺", "內在智慧", "暫緩行動", "觀察"],
  },
  {
    id: "major-3",
    name: "The Empress",
    cnName: "皇后",
    arcana: "major",
    number: 3,
    keywords: ["滋養", "豐盛", "情感安全感", "成長"],
  },
  {
    id: "major-4",
    name: "The Emperor",
    cnName: "皇帝",
    arcana: "major",
    number: 4,
    keywords: ["結構", "權威", "規劃", "界線"],
  },
  {
    id: "major-5",
    name: "The Hierophant",
    cnName: "教皇",
    arcana: "major",
    number: 5,
    keywords: ["傳統", "制度", "老師", "規則"],
  },
  {
    id: "major-6",
    name: "The Lovers",
    cnName: "戀人",
    arcana: "major",
    number: 6,
    keywords: ["選擇", "關係", "價值觀一致", "承諾"],
  },
  {
    id: "major-7",
    name: "The Chariot",
    cnName: "戰車",
    arcana: "major",
    number: 7,
    keywords: ["意志力", "前進", "突破阻力", "專注目標"],
  },
  {
    id: "major-8",
    name: "Strength",
    cnName: "力量",
    arcana: "major",
    number: 8,
    keywords: ["內在力量", "溫柔的堅定", "自信", "調和衝動"],
  },
  {
    id: "major-9",
    name: "The Hermit",
    cnName: "隱者",
    arcana: "major",
    number: 9,
    keywords: ["內省", "暫時退場", "尋找答案", "獨處"],
  },
  {
    id: "major-10",
    name: "Wheel of Fortune",
    cnName: "命運之輪",
    arcana: "major",
    number: 10,
    keywords: ["轉機", "循環", "外在變化", "時機"],
  },
  {
    id: "major-11",
    name: "Justice",
    cnName: "正義",
    arcana: "major",
    number: 11,
    keywords: ["公平", "平衡", "結果承擔", "決策"],
  },
  {
    id: "major-12",
    name: "The Hanged Man",
    cnName: "吊人",
    arcana: "major",
    number: 12,
    keywords: ["換角度", "暫停", "犧牲", "放下執著"],
  },
  {
    id: "major-13",
    name: "Death",
    cnName: "死神",
    arcana: "major",
    number: 13,
    keywords: ["結束", "轉化", "清理舊局", "重生前夕"],
  },
  {
    id: "major-14",
    name: "Temperance",
    cnName: "節制",
    arcana: "major",
    number: 14,
    keywords: ["調和", "節奏", "中庸", "慢慢來"],
  },
  {
    id: "major-15",
    name: "The Devil",
    cnName: "惡魔",
    arcana: "major",
    number: 15,
    keywords: ["束縛", "成癮", "慾望", "被綁住的地方"],
  },
  {
    id: "major-16",
    name: "The Tower",
    cnName: "高塔",
    arcana: "major",
    number: 16,
    keywords: ["突發變故", "崩解", "真相", "重建前的拆除"],
  },
  {
    id: "major-17",
    name: "The Star",
    cnName: "星星",
    arcana: "major",
    number: 17,
    keywords: ["希望", "療癒", "信任未來", "溫柔前進"],
  },
  {
    id: "major-18",
    name: "The Moon",
    cnName: "月亮",
    arcana: "major",
    number: 18,
    keywords: ["不安", "迷霧", "潛意識", "直覺訊號"],
  },
  {
    id: "major-19",
    name: "The Sun",
    cnName: "太陽",
    arcana: "major",
    number: 19,
    keywords: ["喜悅", "成功", "坦率", "清晰"],
  },
  {
    id: "major-20",
    name: "Judgement",
    cnName: "審判",
    arcana: "major",
    number: 20,
    keywords: ["醒悟", "召喚", "重新評估", "重要決定"],
  },
  {
    id: "major-21",
    name: "The World",
    cnName: "世界",
    arcana: "major",
    number: 21,
    keywords: ["完成", "整合", "階段性成果", "新旅程"],
  },

  // ===== Wands 權杖 =====
  {
    id: "wands-1",
    name: "Ace of Wands",
    cnName: "權杖一",
    arcana: "minor",
    suit: "權杖",
    number: 1,
    keywords: ["靈感", "衝勁", "新企劃", "熱情啟動"],
  },
  {
    id: "wands-2",
    name: "Two of Wands",
    cnName: "權杖二",
    arcana: "minor",
    suit: "權杖",
    number: 2,
    keywords: ["規劃", "遠景", "跨出舒適圈"],
  },
  {
    id: "wands-3",
    name: "Three of Wands",
    cnName: "權杖三",
    arcana: "minor",
    suit: "權杖",
    number: 3,
    keywords: ["拓展", "等待成果", "向外發展"],
  },
  {
    id: "wands-4",
    name: "Four of Wands",
    cnName: "權杖四",
    arcana: "minor",
    suit: "權杖",
    number: 4,
    keywords: ["慶祝", "穩定基礎", "階段性成果"],
  },
  {
    id: "wands-5",
    name: "Five of Wands",
    cnName: "權杖五",
    arcana: "minor",
    suit: "權杖",
    number: 5,
    keywords: ["競爭", "磨合", "衝突中的練習"],
  },
  {
    id: "wands-6",
    name: "Six of Wands",
    cnName: "權杖六",
    arcana: "minor",
    suit: "權杖",
    number: 6,
    keywords: ["勝利", "被看見", "肯定與掌聲"],
  },
  {
    id: "wands-7",
    name: "Seven of Wands",
    cnName: "權杖七",
    arcana: "minor",
    suit: "權杖",
    number: 7,
    keywords: ["捍衛立場", "壓力下堅持", "守住成果"],
  },
  {
    id: "wands-8",
    name: "Eight of Wands",
    cnName: "權杖八",
    arcana: "minor",
    suit: "權杖",
    number: 8,
    keywords: ["快速發展", "訊息", "進展加速"],
  },
  {
    id: "wands-9",
    name: "Nine of Wands",
    cnName: "權杖九",
    arcana: "minor",
    suit: "權杖",
    number: 9,
    keywords: ["疲憊", "撐住最後一哩路", "防衛"],
  },
  {
    id: "wands-10",
    name: "Ten of Wands",
    cnName: "權杖十",
    arcana: "minor",
    suit: "權杖",
    number: 10,
    keywords: ["負擔過重", "責任", "需要分工"],
  },
  {
    id: "wands-11",
    name: "Page of Wands",
    cnName: "權杖侍者",
    arcana: "minor",
    suit: "權杖",
    number: 11,
    rank: "Page",
    keywords: ["好奇", "消息", "嘗試新方向"],
  },
  {
    id: "wands-12",
    name: "Knight of Wands",
    cnName: "權杖騎士",
    arcana: "minor",
    suit: "權杖",
    number: 12,
    rank: "Knight",
    keywords: ["衝動行動", "冒險精神", "短期熱情"],
  },
  {
    id: "wands-13",
    name: "Queen of Wands",
    cnName: "權杖皇后",
    arcana: "minor",
    suit: "權杖",
    number: 13,
    rank: "Queen",
    keywords: ["自信", "魅力", "主動外向"],
  },
  {
    id: "wands-14",
    name: "King of Wands",
    cnName: "權杖國王",
    arcana: "minor",
    suit: "權杖",
    number: 14,
    rank: "King",
    keywords: ["領導力", "遠見", "創業型人物"],
  },

  // ===== Cups 聖杯 =====
  {
    id: "cups-1",
    name: "Ace of Cups",
    cnName: "聖杯一",
    arcana: "minor",
    suit: "聖杯",
    number: 1,
    keywords: ["情感開啟", "新關係", "心被觸動"],
  },
  {
    id: "cups-2",
    name: "Two of Cups",
    cnName: "聖杯二",
    arcana: "minor",
    suit: "聖杯",
    number: 2,
    keywords: ["互相吸引", "合作", "情感交流"],
  },
  {
    id: "cups-3",
    name: "Three of Cups",
    cnName: "聖杯三",
    arcana: "minor",
    suit: "聖杯",
    number: 3,
    keywords: ["聚會", "友情", "共享喜悅"],
  },
  {
    id: "cups-4",
    name: "Four of Cups",
    cnName: "聖杯四",
    arcana: "minor",
    suit: "聖杯",
    number: 4,
    keywords: ["情緒倦怠", "不滿足", "需要換角度"],
  },
  {
    id: "cups-5",
    name: "Five of Cups",
    cnName: "聖杯五",
    arcana: "minor",
    suit: "聖杯",
    number: 5,
    keywords: ["失落", "懊悔", "看見尚存的部分"],
  },
  {
    id: "cups-6",
    name: "Six of Cups",
    cnName: "聖杯六",
    arcana: "minor",
    suit: "聖杯",
    number: 6,
    keywords: ["回憶", "童年", "單純的善意"],
  },
  {
    id: "cups-7",
    name: "Seven of Cups",
    cnName: "聖杯七",
    arcana: "minor",
    suit: "聖杯",
    number: 7,
    keywords: ["選擇過多", "幻想", "需要聚焦"],
  },
  {
    id: "cups-8",
    name: "Eight of Cups",
    cnName: "聖杯八",
    arcana: "minor",
    suit: "聖杯",
    number: 8,
    keywords: ["離開不再適合的", "尋找意義", "情感轉身"],
  },
  {
    id: "cups-9",
    name: "Nine of Cups",
    cnName: "聖杯九",
    arcana: "minor",
    suit: "聖杯",
    number: 9,
    keywords: ["願望實現", "滿足", "享受成果"],
  },
  {
    id: "cups-10",
    name: "Ten of Cups",
    cnName: "聖杯十",
    arcana: "minor",
    suit: "聖杯",
    number: 10,
    keywords: ["家庭和樂", "情感圓滿", "關係穩定"],
  },
  {
    id: "cups-11",
    name: "Page of Cups",
    cnName: "聖杯侍者",
    arcana: "minor",
    suit: "聖杯",
    number: 11,
    rank: "Page",
    keywords: ["情感訊息", "靈感", "溫柔好奇"],
  },
  {
    id: "cups-12",
    name: "Knight of Cups",
    cnName: "聖杯騎士",
    arcana: "minor",
    suit: "聖杯",
    number: 12,
    rank: "Knight",
    keywords: ["追尋浪漫", "理想化", "感性行動"],
  },
  {
    id: "cups-13",
    name: "Queen of Cups",
    cnName: "聖杯皇后",
    arcana: "minor",
    suit: "聖杯",
    number: 13,
    rank: "Queen",
    keywords: ["共感力", "情緒敏銳", "照顧他人"],
  },
  {
    id: "cups-14",
    name: "King of Cups",
    cnName: "聖杯國王",
    arcana: "minor",
    suit: "聖杯",
    number: 14,
    rank: "King",
    keywords: ["情緒成熟", "理性中帶溫度", "穩定支持"],
  },

  // ===== Swords 寶劍 =====
  {
    id: "swords-1",
    name: "Ace of Swords",
    cnName: "寶劍一",
    arcana: "minor",
    suit: "寶劍",
    number: 1,
    keywords: ["思考清晰", "真相", "果斷決定"],
  },
  {
    id: "swords-2",
    name: "Two of Swords",
    cnName: "寶劍二",
    arcana: "minor",
    suit: "寶劍",
    number: 2,
    keywords: ["拉鋸", "暫時不看", "需要做決定"],
  },
  {
    id: "swords-3",
    name: "Three of Swords",
    cnName: "寶劍三",
    arcana: "minor",
    suit: "寶劍",
    number: 3,
    keywords: ["心碎", "言語傷害", "痛的覺醒"],
  },
  {
    id: "swords-4",
    name: "Four of Swords",
    cnName: "寶劍四",
    arcana: "minor",
    suit: "寶劍",
    number: 4,
    keywords: ["休息", "暫停思考", "靜養調整"],
  },
  {
    id: "swords-5",
    name: "Five of Swords",
    cnName: "寶劍五",
    arcana: "minor",
    suit: "寶劍",
    number: 5,
    keywords: ["爭執", "雙輸", "勝利卻空虛"],
  },
  {
    id: "swords-6",
    name: "Six of Swords",
    cnName: "寶劍六",
    arcana: "minor",
    suit: "寶劍",
    number: 6,
    keywords: ["過渡", "離開是非之地", "理性轉移"],
  },
  {
    id: "swords-7",
    name: "Seven of Swords",
    cnName: "寶劍七",
    arcana: "minor",
    suit: "寶劍",
    number: 7,
    keywords: ["隱瞞", "小聰明", "策略性行動"],
  },
  {
    id: "swords-8",
    name: "Eight of Swords",
    cnName: "寶劍八",
    arcana: "minor",
    suit: "寶劍",
    number: 8,
    keywords: ["被困住", "自我設限", "看不見出口"],
  },
  {
    id: "swords-9",
    name: "Nine of Swords",
    cnName: "寶劍九",
    arcana: "minor",
    suit: "寶劍",
    number: 9,
    keywords: ["焦慮失眠", "過度擔心", "腦補太多"],
  },
  {
    id: "swords-10",
    name: "Ten of Swords",
    cnName: "寶劍十",
    arcana: "minor",
    suit: "寶劍",
    number: 10,
    keywords: ["結束", "跌落谷底", "重啟的起點"],
  },
  {
    id: "swords-11",
    name: "Page of Swords",
    cnName: "寶劍侍者",
    arcana: "minor",
    suit: "寶劍",
    number: 11,
    rank: "Page",
    keywords: ["好奇心", "觀察", "收集資訊"],
  },
  {
    id: "swords-12",
    name: "Knight of Swords",
    cnName: "寶劍騎士",
    arcana: "minor",
    suit: "寶劍",
    number: 12,
    rank: "Knight",
    keywords: ["衝動直言", "快速行動", "激烈主張"],
  },
  {
    id: "swords-13",
    name: "Queen of Swords",
    cnName: "寶劍皇后",
    arcana: "minor",
    suit: "寶劍",
    number: 13,
    rank: "Queen",
    keywords: ["理性", "獨立", "清楚劃界線"],
  },
  {
    id: "swords-14",
    name: "King of Swords",
    cnName: "寶劍國王",
    arcana: "minor",
    suit: "寶劍",
    number: 14,
    rank: "King",
    keywords: ["分析力", "決策者", "制度與原則"],
  },

  // ===== Pentacles 錢幣 =====
  {
    id: "pentacles-1",
    name: "Ace of Pentacles",
    cnName: "錢幣一",
    arcana: "minor",
    suit: "錢幣",
    number: 1,
    keywords: ["實際機會", "金錢", "資源", "穩定起點"],
  },
  {
    id: "pentacles-2",
    name: "Two of Pentacles",
    cnName: "錢幣二",
    arcana: "minor",
    suit: "錢幣",
    number: 2,
    keywords: ["平衡多重任務", "彈性調度", "時間管理"],
  },
  {
    id: "pentacles-3",
    name: "Three of Pentacles",
    cnName: "錢幣三",
    arcana: "minor",
    suit: "錢幣",
    number: 3,
    keywords: ["合作", "專業", "團隊完成作品"],
  },
  {
    id: "pentacles-4",
    name: "Four of Pentacles",
    cnName: "錢幣四",
    arcana: "minor",
    suit: "錢幣",
    number: 4,
    keywords: ["緊抓不放", "保守", "安全感議題"],
  },
  {
    id: "pentacles-5",
    name: "Five of Pentacles",
    cnName: "錢幣五",
    arcana: "minor",
    suit: "錢幣",
    number: 5,
    keywords: ["匱乏感", "經濟壓力", "被排除感"],
  },
  {
    id: "pentacles-6",
    name: "Six of Pentacles",
    cnName: "錢幣六",
    arcana: "minor",
    suit: "錢幣",
    number: 6,
    keywords: ["資源分配", "互相扶持", "給與收的平衡"],
  },
  {
    id: "pentacles-7",
    name: "Seven of Pentacles",
    cnName: "錢幣七",
    arcana: "minor",
    suit: "錢幣",
    number: 7,
    keywords: ["等待收成", "評估投入與回報", "耐心"],
  },
  {
    id: "pentacles-8",
    name: "Eight of Pentacles",
    cnName: "錢幣八",
    arcana: "minor",
    suit: "錢幣",
    number: 8,
    keywords: ["磨練技術", "持續練習", "專注工作"],
  },
  {
    id: "pentacles-9",
    name: "Nine of Pentacles",
    cnName: "錢幣九",
    arcana: "minor",
    suit: "錢幣",
    number: 9,
    keywords: ["自給自足", "享受成果", "獨立富足"],
  },
  {
    id: "pentacles-10",
    name: "Ten of Pentacles",
    cnName: "錢幣十",
    arcana: "minor",
    suit: "錢幣",
    number: 10,
    keywords: ["家族資源", "長期穩定", "累積的基礎"],
  },
  {
    id: "pentacles-11",
    name: "Page of Pentacles",
    cnName: "錢幣侍者",
    arcana: "minor",
    suit: "錢幣",
    number: 11,
    rank: "Page",
    keywords: ["學習機會", "新專案", "踏實開始"],
  },
  {
    id: "pentacles-12",
    name: "Knight of Pentacles",
    cnName: "錢幣騎士",
    arcana: "minor",
    suit: "錢幣",
    number: 12,
    rank: "Knight",
    keywords: ["穩健前進", "耐心執行", "務實可靠"],
  },
  {
    id: "pentacles-13",
    name: "Queen of Pentacles",
    cnName: "錢幣皇后",
    arcana: "minor",
    suit: "錢幣",
    number: 13,
    rank: "Queen",
    keywords: ["照顧實際需要", "家庭與物質兼顧", "務實溫暖"],
  },
  {
    id: "pentacles-14",
    name: "King of Pentacles",
    cnName: "錢幣國王",
    arcana: "minor",
    suit: "錢幣",
    number: 14,
    rank: "King",
    keywords: ["事業成就", "資源掌控", "長期穩定的老闆型"],
  },
];

// 牌陣定義：位置名稱的單一來源（新增）
const SPREAD_DEFS = {
  "1-single": { cardCount: 1, positions: ["當下指引"] },
  "3-ppf": { cardCount: 3, positions: ["過去", "現在", "未來"] },
  "3-sba": { cardCount: 3, positions: ["目前狀態", "阻礙／盲點", "建議"] },
  "5-general": { cardCount: 5, positions: ["過去", "現在", "未來", "內在因素", "外在環境"] },
  "5-story": {
    cardCount: 5,
    positions: [
      "目前狀態",
      "正在發生的關鍵事件",
      "影響走向的主要因素",
      "接下來的發展方向",
      "最終結果或趨勢",
    ],
  },
  "6-love": {
    cardCount: 6,
    positions: ["你現在的狀態", "對方現在的狀態", "你想要的", "對方想要的", "關係中的阻礙", "未來可能走向"],
  },
  "7-status": {
    cardCount: 7,
    positions: ["過去", "現在", "未來", "內在狀態", "外在環境", "希望與恐懼", "綜合建議"],
  },
  "10-celtic": {
    cardCount: 10,
    positions: [
      "當前狀態",
      "眼前的阻礙",
      "問題根源（深層因素）",
      "最近的過去",
      "可能的未來（不久之後）",
      "較遠的未來走向",
      "你自己（態度與行為）",
      "外在環境與他人",
      "希望與恐懼",
      "總結與整體結果",
    ],
  },
};

// 給前端用：選牌陣時就能拿到位置格
function getSpreadPositions(spreadKey) {
  const def = SPREAD_DEFS[spreadKey];
  return def?.positions || [];
}

// 根據牌陣決定每張牌的位置名稱（改寫：不再 switch）
function assignPositions(cards, spreadKey) {
  const positions = getSpreadPositions(spreadKey);
  return cards.map((c, idx) => ({
    ...c,
    position: positions[idx] || `位置 ${idx + 1}`,
  }));
}



// 抽牌函式：抽 cardCount 張，隨機決定正逆位與位置
function drawTarotCards(cardCount = 3, spreadKey = "") {
  const positions = getSpreadPositions(spreadKey);
  const safeCount = Math.min(cardCount, positions.length || cardCount);

  const deckCopy = [...TAROT_DECK];
  const result = [];

  for (let i = 0; i < safeCount; i++) {
    if (deckCopy.length === 0) break;
    const idx = Math.floor(Math.random() * deckCopy.length);
    const card = deckCopy.splice(idx, 1)[0];

    const orientation = Math.random() < 0.5 ? "正位" : "逆位";

    result.push({
      ...card,
      orientation,
    });
  }

  return assignPositions(result, spreadKey);
}

// ===== 讓 index.html 可以使用這些函式（一定要在最底部） =====
window.getSpreadPositions = getSpreadPositions;
window.drawTarotCards = drawTarotCards;
